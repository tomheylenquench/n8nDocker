# Secure n8n Docker Deployment

[![Deployment Status](https://img.shields.io/badge/status-verified%20working-green)](https://github.com/tomheylenquench/n8nDocker) [![Version](https://img.shields.io/badge/n8n-1.95.3-blue)](https://github.com/n8n-io/n8n) [![License](https://img.shields.io/badge/license-MIT-blue)](LICENSE) [![Read Only](https://img.shields.io/badge/repository-read--only-red)](https://github.com/tomheylenquench/n8nDocker) [![Rulesets](https://img.shields.io/badge/protected%20by-GitHub%20Rulesets-blue)](https://github.com/tomheylenquench/n8nDocker/settings/rules)

> **🤖 AI Generated**: This documentation and associated scripts were generated by Claude Sonnet 4. Please review and test thoroughly before use.

> **📢 NOTICE**: This is a **read-only repository** protected by GitHub Rulesets. It provides a complete n8n deployment solution for **local testing of production-like environments**. For support, please refer to the documentation. Issues and pull requests are automatically closed.

A comprehensive n8n deployment for testing production-like setups locally on your PC. Features queue mode, SSL/TLS security, and scalable architecture. Compatible with Windows, Linux, macOS, and WSL environments.

## 🚀 Features

- **Queue Mode**: Horizontal scaling with multiple worker instances
- **SSL/TLS Security**: End-to-end encryption with Traefik reverse proxy
- **Database Security**: PostgreSQL with SSL encryption and authentication
- **Redis Security**: Password-protected message broker
- **Secrets Management**: Docker secrets for sensitive data
- **Network Isolation**: Multi-tier network architecture
- **Cross-Platform**: Native scripts for Windows (PowerShell) and Linux/macOS/WSL (Bash)
- **Automated Setup**: One-command deployment scripts with optional email configuration
- **Monitoring**: Health checks and comprehensive logging
- **Backup & Recovery**: Automated backup and restore functionality

## ✅ Verified Features

The following features have been tested and confirmed working across platforms:

- ✅ **Complete Deployment**: One-command deployment script works flawlessly
- ✅ **Cross-Platform Support**: PowerShell and Bash scripts with identical functionality
- ✅ **Service Health Monitoring**: All health checks pass (postgres, redis, n8n)
- ✅ **Log Management**: Service-specific and aggregate log viewing
- ✅ **Dynamic Scaling**: Successfully tested scaling from 2 to 3+ workers
- ✅ **Backup System**: Database, secrets, and certificates backup confirmed
- ✅ **Resource Monitoring**: CPU and memory usage tracking
- ✅ **SSL Configuration**: Traefik reverse proxy with SSL termination
- ✅ **Queue Processing**: Redis message broker with worker coordination
- ✅ **Network Isolation**: Multi-tier network security architecture
- ✅ **WSL Integration**: Seamless operation in Windows Subsystem for Linux

## 🖥️ Platform Support

This deployment supports multiple platforms with native scripts:

### 📘 [Windows Guide](README_WINDOWS.md)
- PowerShell scripts for Windows 10/11
- Docker Desktop integration
- Windows-specific setup and troubleshooting

### 🐧 [Linux/macOS/WSL Guide](README_LINUX_MACOS.md)
- Bash scripts for Linux, macOS, and WSL
- Cross-platform compatibility
- Unix-specific setup and troubleshooting

**Both script sets provide identical functionality and can be used interchangeably on the same project!**

## 🏗️ Architecture

```
Internet → Traefik (SSL) → n8n Main Instance → PostgreSQL
                        ↓
                    Redis Queue ← n8n Workers
```

### Components

| Service | Purpose | Network | SSL | Scaling |
|---------|---------|---------|-----|---------|
| Traefik | Reverse proxy & SSL termination | web | ✅ | Single |
| n8n Main | UI, API, workflow management | web, backend | ✅ | Single |
| n8n Workers | Workflow execution | backend | ✅ | Multiple |
| PostgreSQL | Database with SSL encryption | database | ✅ | Single |
| Redis | Message queue | backend | 🔐 | Single |

### Network Architecture & Security

This deployment implements a **multi-tier network security architecture** that provides defense-in-depth through network isolation and segmentation.

#### 🌐 Network Topology

```
┌─────────────────┐
│     Internet    │
└─────────┬───────┘
          │ HTTPS (443) / HTTP (80)
          │
┌─────────▼───────┐     ┌────────────────────────────┐
│     Traefik     │ ←── │        web network         │
│  (Reverse Proxy)│     │    (External Network)     │
└─────────┬───────┘     └────────────────────────────┘
          │ HTTPS Internal
          │
┌─────────▼───────┐     ┌────────────────────────────┐
│   n8n Main      │ ←── │    n8n-backend network     │
│ (UI/API/Queue)  │     │   (Internal Bridge)        │
└─────────┬───────┘     └──┬─────────────────────────┘
          │                │
          │                ▼
          │         ┌──────────────┐
          │         │    Redis     │
          │         │ (Message Queue)
          │         └──────────────┘
          │                ▲
          │                │
          │         ┌──────┴──────┐
          │         │             │
          │    ┌────▼────┐   ┌────▼────┐
          │    │n8n      │   │n8n      │
          │    │Worker-1 │   │Worker-2 │
          │    └─────────┘   └─────────┘
          │
          ▼
┌─────────────────┐     ┌────────────────────────────┐
│   PostgreSQL    │ ←── │   n8n-database network     │
│   (Database)    │     │   (Internal Bridge)        │
└─────────────────┘     └────────────────────────────┘
```

#### 🔒 Container Network Connections

| Container | web | n8n-backend | n8n-database | External Access | Security Level |
|-----------|-----|-------------|--------------|-----------------|----------------|
| **Traefik** | ✅ | ❌ | ❌ | ✅ Public | **Edge** |
| **n8n Main** | ✅ | ✅ | ✅ | ✅ Via Traefik | **DMZ** |
| **n8n Workers** | ❌ | ✅ | ✅ | ❌ Internal Only | **Internal** |
| **Redis** | ❌ | ✅ | ❌ | ❌ Internal Only | **Backend** |
| **PostgreSQL** | ❌ | ❌ | ✅ | ❌ Internal Only | **Data** |

#### 🛡️ Security Architecture Benefits

##### **1. Network Segmentation**
- **Public Tier** (`web` network): Only Traefik has internet access
- **Application Tier** (`n8n-backend`): Internal service communication
- **Data Tier** (`n8n-database`): Database isolation with controlled access

##### **2. Zero-Trust Internal Access**
```yaml
# Example: PostgreSQL is completely isolated
postgres:
  networks:
    - n8n-database  # ONLY this network
  # No access to web or backend networks
  # Only containers on n8n-database can connect
```

##### **3. Traffic Flow Control**

**✅ Allowed Traffic Flows:**
```
Internet → Traefik → n8n Main → PostgreSQL
                  ↓
              Redis ← n8n Workers
```

**❌ Blocked Traffic Flows:**
```
Internet ⛔ n8n Workers (No direct access)
Internet ⛔ PostgreSQL (No direct access)  
Internet ⛔ Redis (No direct access)
n8n Workers ⛔ Internet (No outbound internet)
```

##### **4. Attack Surface Reduction**

| Component | Exposure | Attack Vectors Mitigated |
|-----------|----------|-------------------------|
| **PostgreSQL** | Database network only | • Direct database attacks<br>• SQL injection from external sources<br>• Unauthorized database access |
| **Redis** | Backend network only | • Cache poisoning attacks<br>• Direct Redis exploitation<br>• Memory dump attacks |
| **n8n Workers** | Internal networks only | • Direct worker exploitation<br>• Malicious workflow injection<br>• Resource exhaustion attacks |

##### **5. Network-Level Authentication**

```yaml
# Each network requires explicit connection
networks:
  web:
    external: true          # Managed by Docker
  n8n-backend:
    driver: bridge
    internal: false         # Allows outbound (for worker operations)
  n8n-database:
    driver: bridge
    internal: true          # No internet access
```

#### 🚦 Security Enforcement Examples

##### **Database Protection:**
```bash
# PostgreSQL can ONLY be accessed by containers on n8n-database network
# Direct database connections from internet are impossible
$ docker exec -it postgres psql  # ✅ Works (authorized container)
$ psql -h your-server.com         # ❌ Blocked (no external access)
```

##### **Worker Isolation:**
```bash
# Workers cannot be directly accessed from internet
$ curl https://your-domain.com/    # ✅ Reaches n8n Main via Traefik
$ curl https://your-domain.com:worker  # ❌ No route (workers not exposed)
```

##### **Service Communication:**
```bash
# Services can only communicate through designated networks
n8n-main → postgres     # ✅ Both on n8n-database network
redis → postgres        # ❌ Redis not on n8n-database network
traefik → postgres      # ❌ Traefik not on n8n-database network
```

#### 🔍 Network Security Monitoring

The deployment includes network-level security monitoring:

- **Connection Logging**: All inter-service connections are logged
- **Failed Connection Alerts**: Attempted unauthorized connections are recorded
- **Network Health Checks**: Each network segment is monitored for availability
- **Traffic Analysis**: Network traffic patterns are tracked for anomalies

#### 📊 Security Metrics

| Security Layer | Protection Level | Monitoring |
|----------------|------------------|------------|
| **Edge (Traefik)** | TLS termination, WAF rules | ✅ Access logs |
| **Application (n8n)** | Authentication, authorization | ✅ App logs |
| **Backend (Redis)** | Password auth, network isolation | ✅ Connection logs |
| **Database (PostgreSQL)** | SSL, network isolation, auth | ✅ Query logs |

This network architecture ensures that even if one component is compromised, the attack cannot easily spread to other parts of the system due to network-level isolation and access controls.

## 📁 Project Structure

```
├── README.md                    # This file - platform-agnostic guide
├── README_WINDOWS.md            # Windows/PowerShell specific guide
├── README_LINUX_MACOS.md        # Linux/macOS/WSL specific guide
├── docker-compose.yml           # Main deployment configuration
├── .env                         # Environment variables (generated)
├── .env.template               # Environment template
├── scripts/
│   ├── PowerShell Scripts (Windows)
│   │   ├── Deploy-N8N.ps1         # Main deployment script
│   │   ├── Manage-N8N.ps1         # Management operations
│   │   ├── Generate-Secrets.ps1   # Password and key generation
│   │   └── Generate-Certificates.ps1 # SSL certificate generation
│   └── Bash Scripts (Linux/macOS/WSL)
│       ├── deploy-n8n.sh          # Main deployment script
│       ├── manage-n8n.sh          # Management operations
│       ├── generate-secrets.sh    # Password and key generation
│       └── generate-certificates.sh # SSL certificate generation
├── secrets/                     # Generated secrets (DO NOT COMMIT)
│   ├── postgres_password.txt
│   ├── redis_password.txt
│   ├── n8n_encryption_key.txt
│   ├── n8n_admin_password.txt
│   ├── jwt_secret.txt
│   ├── webhook_password.txt
│   └── SECRETS_INFO.md
└── certs/                       # SSL certificates (DO NOT COMMIT)
    ├── ca.crt
    ├── ca.key
    ├── server.crt
    ├── server.key
    ├── fullchain.pem
    └── CERTIFICATE_INFO.md
```

## 🔐 Security Features

### Network Security
- **Multi-tier networks**: Separation of web, backend, and database layers
- **Internal networks**: Database isolated from external access
- **No-new-privileges**: Containers run with security restrictions

### Authentication & Authorization
- **Docker secrets**: Sensitive data stored securely
- **PostgreSQL SSL**: Encrypted database connections
- **Redis authentication**: Password-protected message broker
- **Admin authentication**: n8n protected with secure credentials

### SSL/TLS Configuration
- **Traefik SSL termination**: Automatic certificate management
- **Security headers**: HSTS, CSP, and other security headers
- **TLS 1.2/1.3**: Modern encryption protocols only
- **Self-signed certificates**: For development (CA certificates for production)

### Container Security
- **Non-root users**: All containers run as unprivileged users
- **Read-only filesystems**: Where possible
- **Resource limits**: Memory and CPU constraints
- **Health checks**: Automatic service monitoring

## 🔧 Configuration

### Key Environment Variables

```bash
# Domain and Security
N8N_HOST=n8n.yourdomain.com
N8N_SECURE_COOKIE=true
N8N_BASIC_AUTH_ACTIVE=true

# Queue Mode Configuration
EXECUTIONS_MODE=queue
QUEUE_HEALTH_CHECK_ACTIVE=true

# Performance Tuning
EXECUTIONS_DATA_PRUNE=true
EXECUTIONS_TIMEOUT=3600

# SSL/TLS
N8N_PROTOCOL=https
N8N_PORT=443
```

### Scaling Configuration

The deployment supports horizontal scaling of worker instances:

- **Default**: 2 worker instances
- **Tested**: Up to 4+ workers
- **Configuration**: Adjust in docker-compose.yml or use management scripts

## 📊 Monitoring & Observability

### Health Checks
- PostgreSQL: Database connectivity and performance
- Redis: Message broker status and queue health
- n8n: Application health endpoints
- Traefik: Proxy and SSL certificate status

### Logging Strategy
- **Centralized logging**: All services log to Docker
- **Service-specific logs**: Individual service debugging
- **Structured logging**: JSON format for parsing
- **Log rotation**: Automatic cleanup of old logs

### Metrics & Monitoring
- Container resource usage (CPU, memory, network)
- Service availability and response times
- Queue depth and processing rates
- Database connection pool status

## 🚨 Common Issues & Solutions

### Deployment Issues
- **"Required file missing"**: Ensure running from project root directory
- **"Docker not found"**: Install Docker and ensure it's running
- **"Network already exists"**: Remove existing network and recreate

### Runtime Issues
- **Workers restarting**: Normal during first 2-3 minutes of deployment
- **SSL certificate errors**: Trust the CA certificate or use production certificates
- **Redis connection drops**: Temporary during startup, should auto-recover

### Performance Issues
- **High memory usage**: Scale workers instead of increasing per-worker concurrency
- **Slow response**: Check database performance and connection pooling
- **Queue backlog**: Scale up worker instances

## 🔄 Migration & Upgrades

### Version Updates
- Use management scripts to update to latest n8n versions
- Backup before any major version upgrades
- Test upgrades in development environment first

### Migration Between Platforms
- Scripts are interchangeable between Windows and Linux/macOS
- Secrets and certificates are platform-independent
- Docker configuration remains identical

## 🧪 Local Testing Environment

This deployment simulates a production-like environment for local development and testing purposes.

### Security Features for Testing
- ✅ Self-signed certificates for local SSL testing
- ✅ Secure password generation for all services
- ✅ Docker secrets implementation
- ✅ Network isolation between services
- ✅ SSL/TLS encryption for database connections

### Performance Testing Capabilities
- ✅ Horizontal scaling with multiple workers
- ✅ Queue-based workflow execution
- ✅ Database connection pooling
- ✅ Health checks and monitoring
- ✅ Resource usage tracking

### When Moving to Production
If you decide to use this setup as a basis for production:
- [ ] Replace self-signed certificates with CA-issued certificates
- [ ] Change default passwords and enable 2FA
- [ ] Configure proper firewall rules and network security
- [ ] Set up external monitoring and alerting
- [ ] Implement proper backup and disaster recovery
- [ ] Configure log aggregation and analysis

## 📚 Resources

- [n8n Official Documentation](https://docs.n8n.io/)
- [Docker Security Best Practices](https://docs.docker.com/engine/security/)
- [Traefik Documentation](https://doc.traefik.io/traefik/)
- [PostgreSQL Security Guide](https://www.postgresql.org/docs/current/security.html)

## 🤝 Support

For platform-specific issues, consult the appropriate guide:
- **Windows**: See [README_WINDOWS.md](README_WINDOWS.md)
- **Linux/macOS/WSL**: See [README_LINUX_MACOS.md](README_LINUX_MACOS.md)

For general questions:
1. Check the troubleshooting sections in platform guides
2. Review Docker and n8n logs using management scripts
3. Consult the official n8n documentation
4. Check the n8n community forum

## 📄 License

This deployment configuration is provided as-is under the MIT License. n8n itself is licensed under the [Sustainable Use License](https://github.com/n8n-io/n8n/blob/master/LICENSE.md).

---

## ⚠️ AI Generation Disclaimer

**This project was generated by Claude Sonnet 4 AI assistant.** While the solution has been tested and verified to work, please be aware that:

- **Review Required**: All scripts, configurations, and documentation should be thoroughly reviewed before use
- **Testing Recommended**: Test in a safe environment before deploying in any critical setting
- **Security Verification**: Have security configurations independently verified by qualified professionals
- **No Warranty**: This AI-generated solution is provided as-is without warranty of any kind
- **User Responsibility**: Users are responsible for validating the solution meets their specific requirements

The AI assistant aimed to create a comprehensive, secure, and well-documented deployment solution, but human oversight and validation remain essential for any deployment, especially in production-like environments.

---

**⚠️ Important**: This setup includes self-signed certificates and is designed for **local testing of production-like environments**. It should not be used directly in production without proper security hardening and CA-issued certificates.